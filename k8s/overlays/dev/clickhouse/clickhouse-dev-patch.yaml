apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: clickhouse
  namespace: shortlink
spec:
  replicas: 1
  template:
    spec:
      containers:
        - name: clickhouse-server
          volumeMounts:
            - name: clickhouse-data
              mountPath: /var/lib/clickhouse
            - name: clickhouse-config
              mountPath: /etc/clickhouse-server/config.d/config.xml
              subPath: config.xml
            - name: clickhouse-config
              mountPath: /etc/clickhouse-server/users.d/users.xml
              subPath: users.xml
            - name: clickhouse-logs
              mountPath: /var/log/clickhouse-server
          resources:
            requests:
              memory: "2Gi"      # Dev: smaller memory
              cpu: "1000m"       # Dev: 1 CPU
            limits:
              memory: "4Gi"      # Dev: smaller limit
              cpu: "2000m"       # Dev: 2 CPU
  volumeClaimTemplates:
    - metadata:
        name: clickhouse-data
      spec:
        accessModes: ["ReadWriteOnce"]
        resources:
          requests:
            storage: 50Gi        # Dev: smaller storage
    - metadata:
        name: clickhouse-logs
      spec:
        accessModes: ["ReadWriteOnce"]
        resources:
          requests:
            storage: 10Gi        # Dev: smaller logs storage